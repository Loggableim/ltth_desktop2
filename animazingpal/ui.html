<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AnimazingPal - Animaze Integration</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }
    .status-connected { background-color: #22c55e; }
    .status-disconnected { background-color: #ef4444; }
    .status-connecting { background-color: #eab308; animation: pulse 1s infinite; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .card {
      background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
      border: 1px solid #3f3f5a;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      color: white;
    }
    .btn-primary { background: #6366f1; color: white; }
    .btn-primary:hover { background: #4f46e5; }
    .btn-success { background: #22c55e; color: white; }
    .btn-success:hover { background: #16a34a; }
    .btn-danger { background: #ef4444; color: white; }
    .btn-danger:hover { background: #dc2626; }
    .btn-secondary { background: #4b5563; color: white; }
    .btn-secondary:hover { background: #374151; }
    .input {
      background: #1e1e2e;
      border: 1px solid #3f3f5a;
      border-radius: 8px;
      padding: 8px 12px;
      color: white;
      width: 100%;
    }
    .input:focus { outline: none; border-color: #6366f1; }
    .select {
      background: #1e1e2e;
      border: 1px solid #3f3f5a;
      border-radius: 8px;
      padding: 8px 12px;
      color: white;
      width: 100%;
    }
    .grid-item {
      background: #2a2a3e;
      border: 1px solid #3f3f5a;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
      pointer-events: auto;
    }
    .grid-item:hover { background: #3a3a4e; border-color: #6366f1; }
    .tab { 
      padding: 12px 24px; 
      cursor: pointer; 
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      color: #9ca3af;
    }
    .tab:hover { background: #2a2a3e; }
    .tab.active { border-bottom-color: #6366f1; color: #6366f1; }
    label, p, span, div {
      color: inherit;
    }
    /* Ensure all text elements have proper contrast */
    body * {
      color: inherit;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div class="container mx-auto p-6 max-w-6xl">
    <!-- Header -->
    <div class="card flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="text-3xl">üé≠</div>
        <div>
          <h1 class="text-2xl font-bold">AnimazingPal</h1>
          <p class="text-gray-400">Animaze VTuber Avatar Integration</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2">
          <span class="status-dot" id="statusDot"></span>
          <span id="statusText">Nicht verbunden</span>
        </div>
        <button class="btn btn-primary" id="connectBtn">Verbinden</button>
        <button class="btn btn-secondary" data-action="refresh">üîÑ Aktualisieren</button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex border-b border-gray-700 mb-4">
      <div class="tab active" data-tab="overview">√úbersicht</div>
      <div class="tab" data-tab="emotes">Emotes & Aktionen</div>
      <div class="tab" data-tab="gifts">Gift Mappings</div>
      <div class="tab" data-tab="events">Event Aktionen</div>
      <div class="tab" data-tab="brain">KI Brain & Personas</div>
      <div class="tab" data-tab="chatpal">ChatPal</div>
      <div class="tab" data-tab="settings">Einstellungen</div>
    </div>

    <!-- Tab Content: Overview -->
    <div id="tab-overview" class="tab-content">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Connection Info -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üîå Verbindung</h2>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-400">Status:</span>
              <span id="connectionStatus">Nicht verbunden</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Host:</span>
              <span id="connectionHost">127.0.0.1:9000</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Avatare:</span>
              <span id="avatarCount">0</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Emotes:</span>
              <span id="emoteCount">0</span>
            </div>
          </div>
          <button class="btn btn-primary w-full mt-4" data-action="test-connection">üß™ Verbindung testen</button>
        </div>

        <!-- Current Avatar -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üë§ Aktueller Avatar</h2>
          <div id="currentAvatarInfo" class="text-gray-400">
            Keine Avatar-Informationen verf√ºgbar
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card col-span-1 md:col-span-2">
          <h2 class="text-xl font-bold mb-4">‚ö° Schnellaktionen</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <button class="grid-item text-center" data-action="calibrate">
              <div class="text-2xl mb-2">üéØ</div>
              <div>Tracker kalibrieren</div>
            </button>
            <button class="grid-item text-center" data-action="broadcast-start">
              <div class="text-2xl mb-2">üìπ</div>
              <div>Broadcast starten</div>
            </button>
            <button class="grid-item text-center" data-action="broadcast-stop">
              <div class="text-2xl mb-2">‚èπÔ∏è</div>
              <div>Broadcast stoppen</div>
            </button>
            <button class="grid-item text-center" data-action="refresh">
              <div class="text-2xl mb-2">üîÑ</div>
              <div>Daten aktualisieren</div>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Emotes & Actions -->
    <div id="tab-emotes" class="tab-content hidden">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Emotes -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üòÄ Emotes</h2>
          <div id="emotesList" class="grid grid-cols-2 gap-2 max-h-96 overflow-y-auto">
            <p class="text-gray-400 col-span-2">Keine Emotes verf√ºgbar</p>
          </div>
        </div>

        <!-- Special Actions -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">‚≠ê Spezialaktionen</h2>
          <div id="specialActionsList" class="grid grid-cols-2 gap-2 max-h-96 overflow-y-auto">
            <p class="text-gray-400 col-span-2">Keine Spezialaktionen verf√ºgbar</p>
          </div>
        </div>

        <!-- Poses -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üßò Posen</h2>
          <div id="posesList" class="grid grid-cols-2 gap-2 max-h-96 overflow-y-auto">
            <p class="text-gray-400 col-span-2">Keine Posen verf√ºgbar</p>
          </div>
        </div>

        <!-- Idle Animations -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üí§ Idle Animationen</h2>
          <div id="idlesList" class="grid grid-cols-2 gap-2 max-h-96 overflow-y-auto">
            <p class="text-gray-400 col-span-2">Keine Idle Animationen verf√ºgbar</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Gift Mappings -->
    <div id="tab-gifts" class="tab-content hidden">
      <div class="card">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">üéÅ Gift Mappings</h2>
          <button class="btn btn-success" data-action="add-gift-mapping">+ Mapping hinzuf√ºgen</button>
        </div>
        <p class="text-gray-400 mb-4">Verkn√ºpfe TikTok Geschenke mit Animaze Aktionen</p>
        <div id="giftMappingsList" class="space-y-3">
          <p class="text-gray-400">Keine Gift Mappings konfiguriert</p>
        </div>
      </div>
    </div>

    <!-- Tab Content: Event Actions -->
    <div id="tab-events" class="tab-content hidden">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Follow Event -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üëã Follow Event</h2>
          <div class="space-y-3">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="followEnabled">
              <span>Aktiviert</span>
            </label>
            <div>
              <label class="text-gray-400 text-sm">Aktionstyp</label>
              <select class="select" id="followActionType">
                <option value="">Keine Aktion</option>
                <option value="emote">Emote</option>
                <option value="specialAction">Spezialaktion</option>
                <option value="pose">Pose</option>
                <option value="idle">Idle Animation</option>
              </select>
            </div>
            <div>
              <label class="text-gray-400 text-sm">Aktion</label>
              <select class="select" id="followActionValue">
                <option value="">Ausw√§hlen...</option>
              </select>
            </div>
            <div>
              <label class="text-gray-400 text-sm">ChatPal Nachricht (optional)</label>
              <input type="text" class="input" id="followChatMessage" placeholder="{username} folgt jetzt!">
            </div>
          </div>
        </div>

        <!-- Share Event -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üì§ Share Event</h2>
          <div class="space-y-3">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="shareEnabled">
              <span>Aktiviert</span>
            </label>
            <div>
              <label class="text-gray-400 text-sm">Aktionstyp</label>
              <select class="select" id="shareActionType">
                <option value="">Keine Aktion</option>
                <option value="emote">Emote</option>
                <option value="specialAction">Spezialaktion</option>
                <option value="pose">Pose</option>
                <option value="idle">Idle Animation</option>
              </select>
            </div>
            <div>
              <label class="text-gray-400 text-sm">Aktion</label>
              <select class="select" id="shareActionValue">
                <option value="">Ausw√§hlen...</option>
              </select>
            </div>
            <div>
              <label class="text-gray-400 text-sm">ChatPal Nachricht (optional)</label>
              <input type="text" class="input" id="shareChatMessage" placeholder="Danke f√ºrs Teilen, {username}!">
            </div>
          </div>
        </div>

        <!-- Subscribe Event -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">‚≠ê Subscribe Event</h2>
          <div class="space-y-3">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="subscribeEnabled">
              <span>Aktiviert</span>
            </label>
            <div>
              <label class="text-gray-400 text-sm">Aktionstyp</label>
              <select class="select" id="subscribeActionType">
                <option value="">Keine Aktion</option>
                <option value="emote">Emote</option>
                <option value="specialAction">Spezialaktion</option>
                <option value="pose">Pose</option>
                <option value="idle">Idle Animation</option>
              </select>
            </div>
            <div>
              <label class="text-gray-400 text-sm">Aktion</label>
              <select class="select" id="subscribeActionValue">
                <option value="">Ausw√§hlen...</option>
              </select>
            </div>
            <div>
              <label class="text-gray-400 text-sm">ChatPal Nachricht (optional)</label>
              <input type="text" class="input" id="subscribeChatMessage" placeholder="Vielen Dank f√ºr das Abo, {username}!">
            </div>
          </div>
        </div>

        <!-- Like Event -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">‚ù§Ô∏è Like Event</h2>
          <div class="space-y-3">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="likeEnabled">
              <span>Aktiviert</span>
            </label>
            <div>
              <label class="text-gray-400 text-sm">Threshold (min. Likes)</label>
              <input type="number" class="input" id="likeThreshold" value="10" min="1">
            </div>
            <div>
              <label class="text-gray-400 text-sm">Aktionstyp</label>
              <select class="select" id="likeActionType">
                <option value="">Keine Aktion</option>
                <option value="emote">Emote</option>
                <option value="specialAction">Spezialaktion</option>
                <option value="pose">Pose</option>
                <option value="idle">Idle Animation</option>
              </select>
            </div>
            <div>
              <label class="text-gray-400 text-sm">Aktion</label>
              <select class="select" id="likeActionValue">
                <option value="">Ausw√§hlen...</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: KI Brain & Personas -->
    <div id="tab-brain" class="tab-content hidden">
      <div class="grid grid-cols-1 gap-4">
        <!-- Brain Settings -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üß† KI Brain Einstellungen</h2>
          <div class="space-y-3">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="brainEnabled">
              <span>KI Brain aktivieren</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="standaloneMode">
              <span>Standalone Mode (AnimazingPal √ºbernimmt volle Kontrolle)</span>
            </label>
            <div>
              <label class="block mb-1">OpenAI API Key</label>
              <input type="password" id="brainApiKey" class="input" placeholder="sk-...">
            </div>
            <div>
              <label class="block mb-1">Model</label>
              <select id="brainModel" class="select">
                <option value="gpt-4o-mini">GPT-4o Mini (empfohlen)</option>
                <option value="gpt-4o">GPT-4o</option>
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
              </select>
            </div>
            <button class="btn btn-primary" id="saveBrainConfig">üíæ Speichern</button>
            <button class="btn btn-secondary" id="testBrainConnection">üß™ Verbindung testen</button>
          </div>
        </div>

        <!-- Persona Management -->
        <div class="card">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold">üé≠ Personas verwalten</h2>
            <button class="btn btn-primary" id="createPersonaBtn">+ Neue Persona</button>
          </div>
          
          <!-- Active Persona Selector -->
          <div class="mb-4">
            <label class="block mb-1">Aktive Persona</label>
            <select id="activePersonaSelect" class="select">
              <option value="">Keine ausgew√§hlt</option>
            </select>
          </div>

          <!-- Persona List -->
          <div id="personaList" class="space-y-2">
            <!-- Personas will be loaded here -->
          </div>
        </div>

        <!-- Persona Editor (Hidden by default) -->
        <div id="personaEditor" class="card hidden">
          <h2 class="text-xl font-bold mb-4">‚úèÔ∏è Persona bearbeiten</h2>
          <div class="space-y-3">
            <input type="hidden" id="editPersonaName">
            <div>
              <label class="block mb-1">Name (ID)</label>
              <input type="text" id="editPersonaId" class="input" placeholder="z.B. meine_persona">
              <small class="text-gray-400">Nur beim Erstellen √§nderbar</small>
            </div>
            <div>
              <label class="block mb-1">Anzeigename</label>
              <input type="text" id="editPersonaDisplayName" class="input" placeholder="z.B. Meine Persona">
            </div>
            <div>
              <label class="block mb-1">Beschreibung</label>
              <textarea id="editPersonaDescription" class="input" rows="2" placeholder="Kurze Beschreibung..."></textarea>
            </div>
            <div>
              <label class="block mb-1">System Prompt</label>
              <textarea id="editPersonaSystemPrompt" class="input" rows="5" placeholder="Du bist ein..."></textarea>
            </div>
            <div>
              <label class="block mb-1">Voice Style</label>
              <input type="text" id="editPersonaVoiceStyle" class="input" placeholder="z.B. warm,friendly,enthusiastic">
            </div>
            <div>
              <label class="block mb-1">Catchphrases (JSON Array)</label>
              <textarea id="editPersonaCatchphrases" class="input" rows="2" placeholder='["Hey!", "Alles klar!"]'></textarea>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <div>
                <label class="block mb-1">Temperature</label>
                <input type="number" id="editPersonaTemperature" class="input" step="0.1" min="0" max="2" value="0.7">
              </div>
              <div>
                <label class="block mb-1">Presence Penalty</label>
                <input type="number" id="editPersonaPresencePenalty" class="input" step="0.1" min="0" max="2" value="0.3">
              </div>
              <div>
                <label class="block mb-1">Frequency Penalty</label>
                <input type="number" id="editPersonaFrequencyPenalty" class="input" step="0.1" min="0" max="2" value="0.2">
              </div>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <div>
                <label class="block mb-1">Default Emote</label>
                <input type="text" id="editPersonaDefaultEmote" class="input" placeholder="smile">
              </div>
              <div>
                <label class="block mb-1">High Energy Emote</label>
                <input type="text" id="editPersonaHighEnergyEmote" class="input" placeholder="excited">
              </div>
              <div>
                <label class="block mb-1">Low Energy Emote</label>
                <input type="text" id="editPersonaLowEnergyEmote" class="input" placeholder="calm">
              </div>
            </div>
            <div class="flex gap-2">
              <button class="btn btn-success" id="savePersonaBtn">üíæ Speichern</button>
              <button class="btn btn-secondary" id="cancelPersonaBtn">‚ùå Abbrechen</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: ChatPal -->
    <div id="tab-chatpal" class="tab-content hidden">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Chat Settings -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üí¨ Chat zu Avatar</h2>
          <div class="space-y-3">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="chatEnabled">
              <span>TikTok Chat an ChatPal weiterleiten</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="chatUseEcho">
              <span>Nur TTS (keine KI-Antwort)</span>
            </label>
            <div>
              <label class="text-gray-400 text-sm">Prefix</label>
              <input type="text" class="input" id="chatPrefix" placeholder="[TikTok]">
            </div>
            <div>
              <label class="text-gray-400 text-sm">Max. Zeichenl√§nge</label>
              <input type="number" class="input" id="chatMaxLength" value="200" min="50" max="500">
            </div>
          </div>
        </div>

        <!-- Manual ChatPal -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4">üó£Ô∏è ChatPal Nachricht senden</h2>
          <div class="space-y-3">
            <div>
              <label class="text-gray-400 text-sm">Nachricht</label>
              <textarea class="input" id="chatpalMessage" rows="3" placeholder="Schreibe eine Nachricht an ChatPal..."></textarea>
            </div>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="chatpalUseEcho">
              <span>Nur TTS (Echo-Modus)</span>
            </label>
            <button class="btn btn-primary w-full" data-action="send-chatpal">üì§ Senden</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Settings -->
    <div id="tab-settings" class="tab-content hidden">
      <div class="card">
        <h2 class="text-xl font-bold mb-4">‚öôÔ∏è Verbindungseinstellungen</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-gray-400 text-sm">Host</label>
            <input type="text" class="input" id="settingsHost" value="127.0.0.1">
          </div>
          <div>
            <label class="text-gray-400 text-sm">Port</label>
            <input type="number" class="input" id="settingsPort" value="9000">
          </div>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="settingsAutoConnect" checked>
            <span>Automatisch verbinden</span>
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="settingsReconnect" checked>
            <span>Automatisch neu verbinden</span>
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="settingsVerbose">
            <span>Ausf√ºhrliches Logging</span>
          </label>
        </div>
        <button class="btn btn-primary mt-4" data-action="save-settings">üíæ Einstellungen speichern</button>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 border border-gray-700 rounded-lg p-4 shadow-lg hidden">
      <p id="toastMessage"></p>
    </div>
  </div>

  <script src="/plugins/animazingpal/ui.js"></script>
</body>
</html>
